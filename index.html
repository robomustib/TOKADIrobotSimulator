<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOKADI SIMULATION GAME | An Educational Tool for Game-Based Learning</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        #gameContainer {
            display: flex;
            align-items: flex-start;
            margin-top: 70px;
        }
        #gameArea {
            position: relative;
            width: 400px;
            height: 400px;
            border: 2px solid #000;
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(10, 1fr);
            gap: 1px;
            background-size: cover;
        }
        #gameArea::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(0deg, transparent, transparent 39px, black 39px, black 40px),
                        repeating-linear-gradient(90deg, transparent, transparent 39px, black 39px, black 40px);
            pointer-events: none;
        }
        #block {
            position: absolute;
            width: 40px;
            height: 50px;
            /* UPDATED: Local path */
            background-image: url('assets/tokadi.png');
            background-size: cover;
            transition: top 0.5s, left 0.5s, transform 0.5s;
        }
        .emotion, #flag, .tool, .battery, .booster {
            position: absolute;
            width: 36px;
            height: 36px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }
        #flag {
            /* UPDATED: Local path */
            background-image: url('assets/flag.svg');
            display: none;
        }
        #congrats {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: green;
            font-weight: bold;
            text-align: center;
            z-index: 10;
            background: rgba(255,255,255,0.9);
            padding: 20px;
            border-radius: 10px;
        }
        #nextLevelButton {
            display: none;
            margin-top: 10px;
            padding: 10px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        #controls {
            margin-left: 20px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        #commands {
            display: flex;
            gap: 5px;
        }
        .command-cell {
            width: 40px;
            height: 40px;
            border: 1px solid #000;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #fff;
        }
        #collection {
            display: flex;
            gap: 5px;
            margin-top: 20px;
        }
        .collection-cell {
            width: 40px;
            height: 40px;
            border: 1px solid #000;
            background-color: #fff;
            object-fit: contain;
        }
        button {
            margin: 5px;
            padding: 10px;
            font-size: 16px;
        }
        #navigation {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }
        #navigation button {
            margin: 5px;
        }
        #musicButton {
            margin-top: 20px;
        }
        #winMessage {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            color: green;
            font-weight: bold;
            text-align: center;
            background: rgba(255,255,255,0.9);
            padding: 20px;
            z-index: 10;
        }
        #restartButton {
            display: none;
            margin-top: 20px;
            padding: 10px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        #titleContainer {
            text-align: center;
            width: 100%;
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
        }
    </style>
</head>
<body>
<div id="titleContainer">
    <h1>TOKADI SIMULATION GAME</h1>
    <h5>An Educational Tool for Game-Based Learning | Beta-version 1.3 | Developer <a href="https://www.mustafabilgin.de" target="_blank">Mustafa Bilgin</a></h5>
</div>
<div id="gameContainer">
    <div id="gameArea">
        <div id="block"></div>
        <div id="battery1" class="battery"></div>
        <div id="battery2" class="battery"></div>
        <div id="battery3" class="battery"></div>
        <div id="booster" class="booster"></div>
        <div id="schraubendreher" class="tool"></div>
        <div id="hammer" class="tool"></div>
        <div id="zahnrad" class="tool"></div>
        <div id="emotion1" class="emotion"></div>
        <div id="emotion2" class="emotion"></div>
        <div id="emotion3" class="emotion"></div>
        <div id="emotion4" class="emotion"></div>
        <div id="emotion5" class="emotion"></div>
        <div id="emotion6" class="emotion"></div>
        <div id="flag"></div>
        <div id="congrats">
            Congratulations!
            <br>
            <button id="nextLevelButton" onclick="nextLevel()">Next level</button>
        </div>
        <div id="winMessage">
            WIN!
            <br>
            <button id="restartButton" onclick="restartGame()">Play again?</button>
        </div>
    </div>
    <div id="controls">
        <div id="actionButtons">
            <button onclick="clearCommands()">X</button>
            <button onclick="executeCommands()">Go</button>
            <button id="musicButton" onclick="toggleMusic()">♪ | ⭘</button>
        </div>
        <div id="navigation">
            <button onclick="addCommand('↑')">↑</button>
            <div>
                <button onclick="addCommand('←')">←</button>
                <button onclick="addCommand('→')">→</button>
            </div>
            <button onclick="addCommand('↓')">↓</button>
        </div>
        <div id="commands"></div>
        <div id="collection"></div>
    </div>
</div>
<audio id="backgroundMusic" loop>
    <source src="assets/music.mp3" type="audio/mpeg">
</audio>
<script>
    let commands = [];
    const block = document.getElementById('block');
    const congrats = document.getElementById('congrats');
    const nextLevelButton = document.getElementById('nextLevelButton');
    const winMessage = document.getElementById('winMessage');
    const restartButton = document.getElementById('restartButton');
    const stepSize = 40;
    let currentDirection = 0;
    let currentLevel = 1;

    // UPDATED: Local paths for items
    const items = {
        level1: [
            { id: 'battery1', icon: 'assets/batterie.svg', collected: false },
            { id: 'battery2', icon: 'assets/batterie.svg', collected: false },
            { id: 'battery3', icon: 'assets/batterie.svg', collected: false },
            { id: 'booster', icon: 'assets/booster.svg', collected: false }
        ],
        level2: [
            { id: 'schraubendreher', icon: 'assets/schraubendreher.svg', collected: false },
            { id: 'hammer', icon: 'assets/hammer.svg', collected: false },
            { id: 'zahnrad', icon: 'assets/zahnrad.svg', collected: false },
            { id: 'emotion1', icon: 'assets/aengstlich.svg', collected: false },
            { id: 'emotion2', icon: 'assets/ekel.svg', collected: false },
            { id: 'emotion3', icon: 'assets/laecheln.svg', collected: false }
        ],
        level3: [
            { id: 'emotion4', icon: 'assets/aengstlich.svg', collected: false },
            { id: 'emotion5', icon: 'assets/ekel.svg', collected: false },
            { id: 'emotion6', icon: 'assets/laecheln.svg', collected: false }
        ]
    };
    const flag = document.getElementById('flag');
    let flagX, flagY;
    const backgroundMusic = document.getElementById('backgroundMusic');
    const musicButton = document.getElementById('musicButton');
    let currentX, currentY;
    
    // Autoplay policy fix: browser might block autoplay
    // Removed strict autoplay from JS start to avoid console errors until interaction
    
    resetGame();
    // Attempt play, but catch error if user hasn't interacted yet
    const playPromise = backgroundMusic.play();
    if (playPromise !== undefined) {
        playPromise.catch(error => {
            // Auto-play was prevented
            musicButton.textContent = '♪ | ⭘';
        });
    }

    musicButton.textContent = '♪ | ⭘';
    
    function toggleMusic() {
        if (backgroundMusic.paused) {
            backgroundMusic.play();
            musicButton.textContent = '♪ | ⏻';
        } else {
            backgroundMusic.pause();
            musicButton.textContent = '♪ | ⭘';
        }
    }
    function resetGame() {
        currentX = Math.floor(Math.random() * 10);
        currentY = Math.floor(Math.random() * 10);
        const gameArea = document.getElementById('gameArea');
        // UPDATED: Local path for background
        gameArea.style.backgroundImage = `url('assets/level${currentLevel}bg.png')`;
        const levelItems = items[`level${currentLevel}`];
        levelItems.forEach((item) => {
            const itemElement = document.getElementById(item.id);
            let itemX, itemY;
            do {
                itemX = Math.floor(Math.random() * 10);
                itemY = Math.floor(Math.random() * 10);
            } while (itemX === currentX && itemY === currentY);
            item.gridX = itemX;
            item.gridY = itemY;
            itemElement.style.backgroundImage = `url('${item.icon}')`;
            itemElement.style.top = `${itemY * stepSize}px`;
            itemElement.style.left = `${itemX * stepSize}px`;
            itemElement.style.display = 'block';
            item.collected = false;
        });
        Object.keys(items).forEach((level) => {
            if (level !== `level${currentLevel}`) {
                items[level].forEach((item) => {
                    document.getElementById(item.id).style.display = 'none';
                });
            }
        });
        flag.style.display = 'none';
        updateBlockPosition();
        congrats.style.display = 'none';
        nextLevelButton.style.display = 'none';
        winMessage.style.display = 'none';
        restartButton.style.display = 'none';
        clearCommands();
        updateCollectionDisplay();
    }
    function addCommand(command) {
        if (commands.length < 5) {
            commands.push(command);
            updateCommandsDisplay();
        }
    }
    function clearCommands() {
        commands = [];
        updateCommandsDisplay();
    }
    function updateCommandsDisplay() {
        const commandsContainer = document.getElementById('commands');
        commandsContainer.innerHTML = '';
        for (let i = 0; i < 5; i++) {
            const cell = document.createElement('div');
            cell.classList.add('command-cell');
            if (i < commands.length) {
                cell.textContent = commands[i];
            }
            commandsContainer.appendChild(cell);
        }
    }
    async function executeCommands() {
        for (let i = 0; i < commands.length; i++) {
            await executeSingleCommand(commands[i]);
            checkItemCollection();
            if (flag.style.display === 'block') {
                checkFlagReached();
            }
        }
        clearCommands();
    }
    function executeSingleCommand(command) {
        return new Promise((resolve) => {
            setTimeout(() => {
                switch (command) {
                    case '↑':
                        moveForward();
                        break;
                    case '↓':
                        moveBackward();
                        break;
                    case '←':
                        turnLeft();
                        break;
                    case '→':
                        turnRight();
                        break;
                }
                updateBlockPosition();
                resolve();
            }, 500);
        });
    }
    function moveForward() {
        switch (currentDirection) {
            case 0:
                if (currentY > 0) currentY--;
                break;
            case 1:
                if (currentX < 9) currentX++;
                break;
            case 2:
                if (currentY < 9) currentY++;
                break;
            case 3:
                if (currentX > 0) currentX--;
                break;
        }
    }
    function moveBackward() {
        switch (currentDirection) {
            case 0:
                if (currentY < 9) currentY++;
                break;
            case 1:
                if (currentX > 0) currentX--;
                break;
            case 2:
                if (currentY > 0) currentY--;
                break;
            case 3:
                if (currentX < 9) currentX++;
                break;
        }
    }
    function turnLeft() {
        currentDirection = (currentDirection - 1 + 4) % 4;
        block.style.transform = `rotate(${currentDirection * 90}deg)`;
    }
    function turnRight() {
        currentDirection = (currentDirection + 1) % 4;
        block.style.transform = `rotate(${currentDirection * 90}deg)`;
    }
    function updateBlockPosition() {
        block.style.top = `${currentY * stepSize}px`;
        block.style.left = `${currentX * stepSize}px`;
    }
    function checkFlagReached() {
        if (currentX === flagX && currentY === flagY) {
            if (currentLevel === 3) {
                winMessage.style.display = 'block';
                restartButton.style.display = 'block';
            } else {
                congrats.style.display = 'block';
                nextLevelButton.style.display = 'block';
            }
        }
    }
    function checkItemCollection() {
        const levelItems = items[`level${currentLevel}`];
        let allItemsCollected;
        if (currentLevel === 1) {
            const batteriesCollected = levelItems.slice(0, 3).every(item => item.collected);
            const boosterCollected = levelItems[3].collected;
            if (batteriesCollected && !boosterCollected) {
                const booster = levelItems[3];
                const boosterElement = document.getElementById(booster.id);
                boosterElement.style.display = 'block';
            }
            allItemsCollected = batteriesCollected && boosterCollected;
        } else {
            allItemsCollected = levelItems.every(item => item.collected);
        }
        levelItems.forEach((item) => {
            if (currentX === item.gridX && currentY === item.gridY && !item.collected) {
                item.collected = true;
                const itemElement = document.getElementById(item.id);
                itemElement.style.display = 'none';
                updateCollectionDisplay();
            }
        });
        if (allItemsCollected && flag.style.display === 'none') {
            flag.style.display = 'block';
            do {
                flagX = Math.floor(Math.random() * 10);
                flagY = Math.floor(Math.random() * 10);
            } while (flagX === currentX && flagY === currentY);
            flag.style.top = `${flagY * stepSize}px`;
            flag.style.left = `${flagX * stepSize}px`;
        }
    }
    function updateCollectionDisplay() {
        const collectionContainer = document.getElementById('collection');
        collectionContainer.innerHTML = '';
        const levelItems = items[`level${currentLevel}`];
        levelItems.forEach((item) => {
            const cell = document.createElement('div');
            cell.classList.add('collection-cell');
            if (item.collected) {
                const img = document.createElement('img');
                img.src = item.icon;
                img.style.width = '100%';
                img.style.height = '100%';
                img.style.objectFit = 'contain';
                cell.appendChild(img);
            }
            collectionContainer.appendChild(cell);
        });
    }
    function nextLevel() {
        currentLevel++;
        if (currentLevel > 3) {
            winMessage.style.display = 'block';
            restartButton.style.display = 'block';
        } else {
            resetGame();
        }
    }
    function restartGame() {
        currentLevel = 1;
        resetGame();
    }
    document.addEventListener('keydown', function(event) {
        switch (event.key) {
            case 'ArrowUp':
                addCommand('↑');
                break;
            case 'ArrowDown':
                addCommand('↓');
                break;
            case 'ArrowLeft':
                addCommand('←');
                break;
            case 'ArrowRight':
                addCommand('→');
                break;
        }
    });
</script>
</body>
</html>
